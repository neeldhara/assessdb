class o{constructor(){this.modal=null,this.isInitialized=!1,this.currentUser=null,this.init()}init(){if(!this.isInitialized){if(console.log("LoginModal: Initializing..."),this.modal=document.getElementById("loginModal"),!this.modal){console.error("LoginModal: Modal element not found!");return}console.log("LoginModal: Modal element found:",this.modal),this.setupEventListeners(),this.setupUserbase(),this.isInitialized=!0,window.loginModal=this,console.log("LoginModal: Initialization complete"),setTimeout(()=>{console.log("Testing modal show functionality..."),console.log("Modal element classes:",this.modal.className),console.log("Modal is hidden:",this.modal.classList.contains("hidden"))},1e3)}}setupEventListeners(){document.getElementById("closeModal")?.addEventListener("click",()=>this.hide()),this.modal?.addEventListener("click",e=>{e.target===this.modal&&this.hide()}),document.getElementById("loginTab")?.addEventListener("click",()=>this.showLoginForm()),document.getElementById("signupTab")?.addEventListener("click",()=>this.showSignupForm()),document.getElementById("modalLoginForm")?.addEventListener("submit",e=>this.handleLogin(e)),document.getElementById("modalSignupForm")?.addEventListener("submit",e=>this.handleSignup(e)),document.getElementById("modalLogoutBtn")?.addEventListener("click",()=>this.handleLogout()),document.addEventListener("showLoginModal",()=>{console.log("showLoginModal event received, opening modal"),this.show()}),document.addEventListener("keydown",e=>{e.key==="Escape"&&!this.modal?.classList.contains("hidden")&&this.hide()})}async setupUserbase(){if(typeof userbase>"u"){console.log("Waiting for Userbase SDK to load..."),document.addEventListener("userbaseReady",()=>{this.initializeUserbase()});return}this.initializeUserbase()}async initializeUserbase(){if(typeof userbase>"u"){console.error("Userbase SDK still not available");return}try{await userbase.init({appId:"b4087b4c-d990-4ab0-8bb7-3c0e6acef0ff"}),console.log("Userbase initialized successfully");const e=await userbase.getSession();e.user&&this.handleLoginSuccess(e.user)}catch(e){console.error("Failed to initialize Userbase:",e)}}show(){console.log("LoginModal.show() called"),this.modal?(console.log("Modal element found, showing modal"),this.modal.classList.remove("hidden"),this.modal.classList.add("flex")):console.error("Modal element not found!");const e=this.modal.querySelector("input");e&&setTimeout(()=>e.focus(),100)}hide(){this.modal&&(this.modal.classList.add("hidden"),document.body.style.overflow="",this.clearErrors())}showLoginForm(){document.getElementById("loginTab")?.classList.add("bg-white","dark:bg-gray-600","text-blue-600","dark:text-blue-400","shadow-sm"),document.getElementById("loginTab")?.classList.remove("text-gray-500","dark:text-gray-400"),document.getElementById("signupTab")?.classList.remove("bg-white","dark:bg-gray-600","text-blue-600","dark:text-blue-400","shadow-sm"),document.getElementById("signupTab")?.classList.add("text-gray-500","dark:text-gray-400"),document.getElementById("modalLoginForm")?.classList.remove("hidden"),document.getElementById("modalSignupForm")?.classList.add("hidden")}showSignupForm(){document.getElementById("signupTab")?.classList.add("bg-white","dark:bg-gray-600","text-blue-600","dark:text-blue-400","shadow-sm"),document.getElementById("signupTab")?.classList.remove("text-gray-500","dark:text-gray-400"),document.getElementById("loginTab")?.classList.remove("bg-white","dark:bg-gray-600","text-blue-600","dark:text-blue-400","shadow-sm"),document.getElementById("loginTab")?.classList.add("text-gray-500","dark:text-gray-400"),document.getElementById("modalSignupForm")?.classList.remove("hidden"),document.getElementById("modalLoginForm")?.classList.add("hidden")}async handleLogin(e){e.preventDefault();const t=document.getElementById("modalLoginUsername")?.value?.trim(),s=document.getElementById("modalLoginPassword")?.value;if(!(!t||!s)){this.showLoading(),this.clearErrors();try{const n=await userbase.signIn({username:t,password:s,rememberMe:"local"});this.handleLoginSuccess(n)}catch(n){this.showError("modalLoginError",n.message||"Login failed")}finally{this.hideLoading()}}}async handleSignup(e){e.preventDefault();const t=document.getElementById("modalSignupUsername")?.value?.trim(),s=document.getElementById("modalSignupPassword")?.value;if(!(!t||!s)){this.showLoading(),this.clearErrors();try{const n=await userbase.signUp({username:t,password:s,rememberMe:"local"});this.handleLoginSuccess(n)}catch(n){this.showError("modalSignupError",n.message||"Signup failed")}finally{this.hideLoading()}}}async handleLogout(){try{await userbase.signOut(),this.handleLogoutSuccess()}catch(e){console.error("Logout failed:",e)}}handleLoginSuccess(e){this.currentUser=e;const t=document.getElementById("modalUsername");t&&(t.textContent=e.username),document.getElementById("modalAuthForms")?.classList.add("hidden"),document.getElementById("modalUserInfo")?.classList.remove("hidden"),document.dispatchEvent(new CustomEvent("userbaseLogin",{detail:e})),setTimeout(()=>this.hide(),1500)}handleLogoutSuccess(){this.currentUser=null,document.getElementById("modalUserInfo")?.classList.add("hidden"),document.getElementById("modalAuthForms")?.classList.remove("hidden"),document.getElementById("modalLoginForm")?.reset(),document.getElementById("modalSignupForm")?.reset(),document.dispatchEvent(new CustomEvent("userbaseLogout")),this.hide()}showLoading(){document.getElementById("modalLoading")?.classList.remove("hidden"),document.getElementById("modalAuthForms")?.classList.add("hidden"),document.getElementById("modalUserInfo")?.classList.add("hidden")}hideLoading(){document.getElementById("modalLoading")?.classList.add("hidden"),this.currentUser?document.getElementById("modalUserInfo")?.classList.remove("hidden"):document.getElementById("modalAuthForms")?.classList.remove("hidden")}showError(e,t){const s=document.getElementById(e);s&&(s.textContent=t,s.classList.remove("hidden"))}clearErrors(){document.getElementById("modalLoginError")?.classList.add("hidden"),document.getElementById("modalSignupError")?.classList.add("hidden")}isLoggedIn(){return!!this.currentUser}getCurrentUser(){return this.currentUser}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>new o):new o;
